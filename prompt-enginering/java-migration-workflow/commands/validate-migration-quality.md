---
allowed-tools: Task, Read, Write, TodoWrite, RunTerminal
description: Validate the quality of a completed Java migration by performing code review, verifying functional preservation, validating compilation, executing tests, and fixing compatibility issues
required-agents: orchestrator, migration-quality-validator
---
# Migration Quality Validation

## Description

Validate the quality of a completed Java/Spring Boot migration by coordinating specialist agents to perform comprehensive code review, verify functional preservation, validate compilation, execute tests, and fix compatibility issues. Claude Code (YOU) acts as the coordinator. The orchestrator agent only prepares structure and later synthesizes outputs. The final deliverable is:

1. A README file named README-YYYY-MM-DD-HH:MM:SS.md with the CURRENT timestamp placed inside the orchestrator agent directory that contains a short project description and an index linking to every report produced by the agents

When creating the README index, list only the title for each report and link directly to the file using an absolute path that begins at the repository root with a single leading slash. Example link format: 

```
[Migration Validation Report](/<link-to-the-report>)
```

Validate every link before saving the README and ensure the path truly exists. Use the MANIFEST.md managed by the orchestrator agent as the source of truth to map all produced reports. It is INITIALIZED in Phase 1, UPDATED after the validation agent completes in Phase 2, and FINALIZED in Phase 3. Make sure to inform this behavior to the **orchestrator** Agent.

## Output template

Use the following template for the README file. Replace placeholders and remove any empty sections. Do not insert horizontal rules.

```
# <Project Name> Migration Quality Validation Report

<Short project description in one or two paragraphs>.
<Short description explaining about the goals of this document which is the validation of migration quality, ensuring functional preservation, compilation success, and test execution.

Generated on: YYYY-MM-DD HH:MM:SS

## Validation Summary
<Overall validation status and key findings>

## Reports Index
<Links to all generated reports>
```

## Critical Constraints

1. NEVER hand the full workflow to the orchestrator agent
2. The orchestrator agent MUST execute ONLY two responsibilities. a) Phase 1 creates project structure according to the agent specification or explicit user flags such as --project-folder, --output-folder and --ignore-folders. b) Phase 3 synthesizes the outputs generated by the validation agent
3. Maintain STRICT agent separation a) Invoke each specialist agent in a separate Task call. b) The orchestrator agent must not spawn subagents. c) Claude Code (YOU) is the coordinator who sequences phases
4. FOLLOW EXACTLY the written specification of every agent stored under .claude/agents
5. NEVER write outputs outside the designated locations. NEVER create folders that are not explicitly defined by the orchestrator or the agent specifications
6. NEVER provide recommendations, action plans, or upgrade instructions in the Project Overview. Summarize only what the validation agent reported
7. DO NOT estimate times or durations. AVOID vague language such as probably safe or should be fine
8. The migration-quality-validator agent WILL modify code and tests to fix compatibility issues, but MUST NEVER alter business logic
9. The migration-quality-validator agent MUST iterate on test fixes until all tests pass or maximum iterations are reached

### MANDATORY AGENT SEPARATION

* Each agent MUST be invoked with a separate Task tool call
* The orchestrator MUST NOT be asked to spawn sub-agents itself
* YOU (Claude Code) are the coordinator, NOT the orchestrator agent
* All communication flows through YOU as the coordinator. YOU decide which new agents to start. After any agent finishes, YOU MUST trigger the orchestrator to update MANIFEST.md. In practice, this means calling Task(orchestrator) once per completed agent task so it can append the entry (title, absolute path rooted at /, agent, timestamp). Example: when Task(migration-quality-validator) completes, immediately invoke Task(orchestrator) to record the Validation Report in MANIFEST.md.

## Execution Workflow

**Phase 1: Task(orchestrator)**

1. Read user flags and normalize paths. Respect --project-folder and --output-folder when provided. If not provided, use the default locations defined by the orchestrator specification
2. Create only the directories required by the orchestrator specification. Do not invent extra levels like output or reports unless the orchestrator specification itself requires them
3. Apply ignore list before any file reading. Never parse or scan files inside any folder listed in --ignore-folders
4. Initialize **MANIFEST.md** in the orchestrator directory with an empty index structure (title, absolute path, agent, timestamp).
5. Verify that migration output reports exist in the docs/ directory. If missing, note this in MANIFEST.md but proceed with validation using codebase analysis

**Phase 2: Task(migration-quality-validator)**

1. Task(migration-quality-validator) reads all migration output reports from the docs/ directory:
   - Architecture Report from architectural-analyzer
   - Dependency Audit Report from dependency-auditor
   - Migration Result Report from migration-guide
2. Task(migration-quality-validator) performs comprehensive code review to verify:
   - Functional behavior preservation (100% business logic preserved)
   - Migration correctness
   - Code quality
3. Task(migration-quality-validator) validates compilation:
   - Verifies Java 21 compatibility
   - Verifies Spring Boot version is updated
   - Attempts to compile the project
   - Fixes compilation errors if any
4. Task(migration-quality-validator) executes tests:
   - Runs all unit tests
   - Runs all integration tests
   - Identifies failing tests
   - Iteratively fixes test failures (updates mocks, fixes compatibility issues)
   - Continues until all tests pass or maximum iterations reached
   - NEVER alters business logic during fixes
5. Task(migration-quality-validator) verifies functional preservation:
   - Compares business logic before/after
   - Validates API contracts
   - Checks data models
   - Verifies security configurations
6. Task(migration-quality-validator) produces a complete **MIGRATION_VALIDATION_RESULT** report documenting:
   - All findings from code review
   - Compilation validation results
   - Test execution results and iteration history
   - All fixes applied
   - Unresolved issues (if any)
   - Functional preservation verification
   - Quality metrics
7. Important: ONLY the orchestrator appends to **MANIFEST.md** when this Task completes
8. IMPORTANT: The migration-quality-validator agent is allowed to modify code and tests to fix compatibility issues, but MUST NEVER alter business logic

**Phase 3: Task(orchestrator)**

1. Aggregate references to all generated reports
2. FINALIZE **MANIFEST.md** inside the orchestrator agent directory: validate all entries, ensure titles and absolute paths exist, de-duplicate, confirm agent names and timestamps

**Phase 4: Task(YOU)**

1. Read MANIFEST.md from the orchestrator directory. Build the index using report titles and absolute links that start with a single slash
2. Validate each link before writing. Use the link validation algorithm defined below
3. Save README-YYYY-MM-DD-HH:MM:SS.md with the CURRENT date time inside the orchestrator directory

**REMEMBER:** The orchestrator agent is just another specialist that:

* Sets up project structure (Phase 1)
* Synthesizes outputs (Phase 3)
* It DOES NOT coordinate other agents - that's YOUR job (YOU, Claude Code)

## Usage Examples

Use `$ARGUMENTS` as the project folder and, if provided, the output files path and name.

NEVER use any other paths to save reports, files, or manifests unless they are explicitly provided by the user. Do not create subfolders such as `reports` or `output`.

NEVER create any files or folders that are not specified in the agent specification.

FOLLOW EXACTLY the output pattern defined below.

```bash
# Run the validation workflow on the project based on the root folder
/validate-migration-quality

# Run the validation workflow on the project folder provided by the user
/validate-migration-quality --project-folder=project-folder

# Run the validation workflow and save the reports in the folder provided by the user. All reports, files and manifests have to be saved in the output folder using the following pattern: <output-folder>/<agent-name>/<file-name-provided-by-agent>.md. For example: output-folder/migration-quality-validator/migration-validation-result-YYYY-MM-DD-HH:MM:SS.md
/validate-migration-quality --project-folder=project-folder --output-folder=output-folder

# Run the validation workflow and ignore the folders provided by the user. Do not read or audit the files in the folders provided by the user.
/validate-migration-quality --ignore-folders=adk_repo,venv,.env,node_modules,.git
```

## Negative Instructions

1. NEVER alter business logic under any circumstances
   * Forbidden: Changing business rules, modifying core functionality, altering data models in ways that change behavior
   * Allowed: Fixing compatibility issues, updating mocks, fixing API calls for new versions, updating test configurations

2. DO NOT skip test failures without documenting them
   * Forbidden: Ignoring failing tests, hiding test failures, removing test cases
   * Allowed: Fixing test failures iteratively, documenting unresolved failures clearly

3. DO NOT hide unresolved issues
   * Forbidden: Not documenting issues that could not be fixed, hiding compilation errors, concealing test failures
   * Allowed: Clearly marking all unresolved issues in the validation report

4. DO NOT use vague language
   * Avoid phrases like "probably safe", "should be fine", "seems OK", "looks stable"
   * Use neutral, factual wording lifted from the validation agent's report

5. DO NOT use emojis or stylized characters

6. DO NOT provide time estimates
   * Forbidden: "in 2 hours", "by tomorrow", "within X days", or any duration claims
   * If timing is requested, state that estimates are out of scope for this command

7. NEVER create agent folders in the repository root
   * Forbidden: "/agents", "/migration-quality-validator" at the repository root
   * Allowed: Only use the paths specified by each agent or by the orchestrator, for example `docs/agents/orchestrator`

8. NEVER create files or folders that are not specified by the agent or orchestrator specifications
   * Forbidden: ad-hoc directories like "reports", "output", "tmp" unless they are explicitly defined
   * All outputs must follow `<output-folder>/<agent-name>/<file-name-provided-by-agent>.md` or be stored in the orchestrator directory as specified

9. NEVER duplicate a report. If you have to make any changes, edit the report that already exists instead of creating a new one
   * Forbidden: duplicate a validation report during the review if a report already exists

10. NEVER stop test iteration prematurely
    * The validation agent must iterate on test fixes until all tests pass or a reasonable maximum is reached (e.g., 5-10 iterations)
    * Document each iteration in the report

## Observations

**Ultrathink** each step of the workflow and determine the clearest instructions for every agent so they can complete their tasks. As the coordinator/master (YOU), you MUST provide all necessary context to each agent. To do this, read every agent specification, understand step by step what each agent must do, and pass along the specific inputs, constraints, and paths they require to succeed.

The orchestrator alone maintains **MANIFEST.md**. Instruct the orchestrator to append a new entry to **MANIFEST.md** immediately after any agent finishes, recording the report title, the absolute path rooted at `/`, the agent name, and the timestamp.

Example: As soon as the **Migration Validation Report** is ready, the orchestrator MUST append its entry to **MANIFEST.md** and mark that task as completed.

The migration-quality-validator agent requires access to migration output reports in the docs/ directory. These reports should have been generated by a previous run of the run-java-migration command. If these reports are missing, the validation agent will proceed with codebase analysis but note this limitation.

The migration-quality-validator agent is allowed to modify code and tests to fix compatibility issues, but MUST NEVER alter business logic. All fixes must be compatibility-related (mocks, API calls, configurations) and must preserve 100% of functional behavior.

The validation agent must iterate on test fixes until all tests pass or a reasonable maximum number of iterations is reached. Each iteration must be documented in the validation report.

## Test Execution Requirements

The migration-quality-validator agent must:

1. Execute all tests (unit and integration)
2. Capture initial test results
3. For each failing test:
   - Analyze root cause
   - Determine if fix is compatibility-related (not business logic)
   - Apply fix (update mocks, fix API calls, update configurations)
   - Re-run tests
   - Document fix in report
4. Continue iterating until:
   - All tests pass, OR
   - Maximum iterations reached (document remaining failures)
5. Never alter business logic during test fixes
6. Preserve test coverage scope

## Functional Preservation Requirements

The migration-quality-validator agent must verify:

1. No business logic was altered during migration
2. API contracts remain the same
3. Data models are unchanged
4. Security rules are preserved
5. Integration behavior is maintained
6. All business rules continue to work as before

If any concerns about functional preservation are identified, they must be clearly documented in the validation report under "Unresolved Issues" or "Functional Preservation Verification" sections.
